"use client";

import React, { useRef, useEffect } from 'react';

// 硬编码从生成器获得的点阵坐标数据
const points: [number, number][] = [[0,0],[5,0],[10,0],[15,0],[20,0],[25,0],[30,0],[35,0],[40,0],[45,0],[50,0],[55,0],[60,0],[65,0],[70,0],[75,0],[80,0],[85,0],[90,0],[95,0],[100,0],[105,0],[110,0],[115,0],[120,0],[125,0],[130,0],[135,0],[140,0],[145,0],[150,0],[155,0],[160,0],[165,0],[170,0],[175,0],[180,0],[185,0],[190,0],[195,0],[200,0],[205,0],[210,0],[215,0],[220,0],[225,0],[230,0],[235,0],[240,0],[245,0],[250,0],[255,0],[260,0],[265,0],[270,0],[275,0],[280,0],[285,0],[290,0],[295,0],[300,0],[0,5],[5,5],[10,5],[15,5],[20,5],[25,5],[30,5],[35,5],[40,5],[45,5],[50,5],[55,5],[60,5],[65,5],[70,5],[75,5],[80,5],[85,5],[90,5],[95,5],[100,5],[105,5],[110,5],[115,5],[120,5],[125,5],[130,5],[135,5],[140,5],[145,5],[150,5],[155,5],[160,5],[165,5],[170,5],[175,5],[180,5],[185,5],[190,5],[195,5],[200,5],[205,5],[210,5],[215,5],[220,5],[225,5],[230,5],[235,5],[240,5],[245,5],[250,5],[255,5],[260,5],[265,5],[270,5],[275,5],[280,5],[285,5],[290,5],[295,5],[300,5],[0,10],[5,10],[10,10],[15,10],[20,10],[25,10],[30,10],[35,10],[40,10],[45,10],[50,10],[55,10],[60,10],[65,10],[70,10],[75,10],[80,10],[85,10],[90,10],[95,10],[100,10],[105,10],[110,10],[115,10],[120,10],[125,10],[130,10],[135,10],[140,10],[145,10],[150,10],[155,10],[160,10],[165,10],[170,10],[175,10],[180,10],[185,10],[190,10],[195,10],[200,10],[205,10],[210,10],[215,10],[220,10],[225,10],[230,10],[235,10],[240,10],[245,10],[250,10],[255,10],[260,10],[265,10],[270,10],[275,10],[280,10],[285,10],[290,10],[295,10],[300,10],[0,15],[5,15],[10,15],[15,15],[20,15],[25,15],[30,15],[35,15],[40,15],[45,15],[50,15],[55,15],[60,15],[65,15],[70,15],[75,15],[80,15],[85,15],[90,15],[95,15],[100,15],[105,15],[110,15],[115,15],[120,15],[125,15],[130,15],[135,15],[140,15],[145,15],[150,15],[155,15],[160,15],[165,15],[170,15],[175,15],[180,15],[185,15],[190,15],[195,15],[200,15],[205,15],[210,15],[215,15],[220,15],[225,15],[230,15],[235,15],[240,15],[245,15],[250,15],[255,15],[260,15],[265,15],[270,15],[275,15],[280,15],[285,15],[290,15],[295,15],[300,15],[0,20],[5,20],[10,20],[15,20],[20,20],[25,20],[30,20],[35,20],[40,20],[45,20],[50,20],[55,20],[60,20],[65,20],[70,20],[75,20],[80,20],[85,20],[90,20],[95,20],[100,20],[105,20],[110,20],[115,20],[120,20],[125,20],[130,20],[135,20],[140,20],[145,20],[150,20],[155,20],[160,20],[165,20],[170,20],[175,20],[180,20],[185,20],[190,20],[195,20],[200,20],[205,20],[210,20],[215,20],[220,20],[225,20],[230,20],[235,20],[240,20],[245,20],[250,20],[255,20],[260,20],[265,20],[270,20],[275,20],[280,20],[285,20],[290,20],[295,20],[300,20],[0,25],[5,25],[10,25],[15,25],[20,25],[25,25],[30,25],[35,25],[40,25],[45,25],[50,25],[55,25],[60,25],[65,25],[70,25],[75,25],[80,25],[85,25],[90,25],[95,25],[100,25],[105,25],[110,25],[115,25],[120,25],[125,25],[130,25],[135,25],[140,25],[145,25],[150,25],[155,25],[160,25],[165,25],[170,25],[175,25],[180,25],[185,25],[190,25],[195,25],[200,25],[205,25],[210,25],[215,25],[220,25],[225,25],[230,25],[235,25],[240,25],[245,25],[250,25],[255,25],[260,25],[265,25],[270,25],[275,25],[280,25],[285,25],[290,25],[295,25],[300,25],[0,30],[5,30],[10,30],[15,30],[20,30],[25,30],[30,30],[35,30],[40,30],[45,30],[50,30],[55,30],[60,30],[65,30],[70,30],[75,30],[80,30],[85,30],[90,30],[95,30],[100,30],[105,30],[110,30],[115,30],[120,30],[125,30],[130,30],[135,30],[140,30],[145,30],[150,30],[155,30],[160,30],[165,30],[170,30],[175,30],[180,30],[185,30],[190,30],[195,30],[200,30],[205,30],[210,30],[215,30],[220,30],[225,30],[230,30],[235,30],[240,30],[245,30],[250,30],[255,30],[260,30],[265,30],[270,30],[275,30],[280,30],[285,30],[290,30],[295,30],[300,30],[0,35],[5,35],[10,35],[15,35],[20,35],[25,35],[30,35],[35,35],[40,35],[45,35],[50,35],[55,35],[60,35],[65,35],[70,35],[75,35],[80,35],[85,35],[90,35],[95,35],[100,35],[105,35],[110,35],[115,35],[120,35],[125,35],[130,35],[135,35],[140,35],[145,35],[150,35],[155,35],[160,35],[165,35],[170,35],[175,35],[180,35],[185,35],[190,35],[195,35],[200,35],[205,35],[210,35],[215,35],[220,35],[225,35],[230,35],[235,35],[240,35],[245,35],[250,35],[255,35],[260,35],[265,35],[270,35],[275,35],[280,35],[285,35],[290,35],[295,35],[300,35],[0,40],[5,40],[10,40],[15,40],[20,40],[25,40],[30,40],[35,40],[40,40],[45,40],[50,40],[55,40],[60,40],[65,40],[70,40],[75,40],[80,40],[85,40],[90,40],[95,40],[100,40],[105,40],[110,40],[115,40],[120,40],[125,40],[130,40],[135,40],[140,40],[145,40],[150,40],[155,40],[160,40],[165,40],[170,40],[175,40],[180,40],[185,40],[190,40],[195,40],[200,40],[205,40],[210,40],[215,40],[220,40],[225,40],[230,40],[235,40],[240,40],[245,40],[250,40],[255,40],[260,40],[265,40],[270,40],[275,40],[280,40],[285,40],[290,40],[295,40],[300,40],[0,45],[5,45],[10,45],[15,45],[20,45],[25,45],[30,45],[35,45],[40,45],[45,45],[50,45],[55,45],[60,45],[65,45],[70,45],[75,45],[80,45],[85,45],[90,45],[95,45],[100,45],[105,45],[110,45],[115,45],[120,45],[125,45],[130,45],[135,45],[140,45],[145,45],[150,45],[155,45],[160,45],[165,45],[170,45],[175,45],[180,45],[185,45],[190,45],[195,45],[200,45],[205,45],[210,45],[215,45],[220,45],[225,45],[230,45],[235,45],[240,45],[245,45],[250,45],[255,45],[260,45],[265,45],[270,45],[275,45],[280,45],[285,45],[290,45],[295,45],[300,45],[0,50],[5,50],[10,50],[15,50],[20,50],[25,50],[30,50],[35,50],[40,50],[45,50],[50,50],[55,50],[60,50],[65,50],[70,50],[75,50],[80,50],[85,50],[90,50],[95,50],[100,50],[105,50],[110,50],[115,50],[120,50],[125,50],[130,50],[135,50],[140,50],[145,50],[150,50],[155,50],[160,50],[165,50],[170,50],[175,50],[180,50],[185,50],[190,50],[195,50],[200,50],[205,50],[210,50],[215,50],[220,50],[225,50],[230,50],[235,50],[240,50],[245,50],[250,50],[255,50],[260,50],[265,50],[270,50],[275,50],[280,50],[285,50],[290,50],[295,50],[300,50],[0,55],[5,55],[10,55],[15,55],[20,55],[25,55],[30,55],[35,55],[40,55],[45,55],[50,55],[55,55],[60,55],[65,55],[70,55],[75,55],[80,55],[85,55],[90,55],[95,55],[100,55],[105,55],[110,55],[115,55],[120,55],[125,55],[130,55],[135,55],[140,55],[145,55],[150,55],[155,55],[160,55],[165,55],[170,55],[175,55],[180,55],[185,55],[190,55],[195,55],[200,55],[205,55],[210,55],[215,55],[220,55],[225,55],[230,55],[235,55],[240,55],[245,55],[250,55],[255,55],[260,55],[265,55],[270,55],[275,55],[280,55],[285,55],[290,55],[295,55],[300,55],[0,60],[5,60],[10,60],[15,60],[20,60],[25,60],[30,60],[35,60],[40,60],[45,60],[50,60],[55,60],[60,60],[65,60],[70,60],[75,60],[80,60],[85,60],[90,60],[95,60],[100,60],[105,60],[110,60],[115,60],[120,60],[125,60],[130,60],[135,60],[140,60],[145,60],[150,60],[155,60],[160,60],[165,60],[170,60],[175,60],[180,60],[185,60],[190,60],[195,60],[200,60],[205,60],[210,60],[215,60],[220,60],[225,60],[230,60],[235,60],[240,60],[245,60],[250,60],[255,60],[260,60],[265,60],[270,60],[275,60],[280,60],[285,60],[290,60],[295,60],[300,60],[0,65],[5,65],[10,65],[15,65],[20,65],[25,65],[30,65],[35,65],[40,65],[45,65],[50,65],[55,65],[60,65],[65,65],[70,65],[75,65],[80,65],[85,65],[90,65],[95,65],[100,65],[105,65],[110,65],[115,65],[120,65],[125,65],[130,65],[135,65],[140,65],[145,65],[150,65],[155,65],[160,65],[165,65],[170,65],[175,65],[180,65],[185,65],[190,65],[195,65],[200,65],[205,65],[210,65],[215,65],[220,65],[225,65],[230,65],[235,65],[240,65],[245,65],[250,65],[255,65],[260,65],[265,65],[270,65],[275,65],[280,65],[285,65],[290,65],[295,65],[300,65],[0,70],[5,70],[10,70],[15,70],[20,70],[25,70],[30,70],[35,70],[40,70],[45,70],[50,70],[55,70],[60,70],[65,70],[70,70],[75,70],[80,70],[85,70],[90,70],[95,70],[100,70],[105,70],[110,70],[115,70],[120,70],[125,70],[130,70],[135,70],[140,70],[145,70],[150,70],[155,70],[160,70],[165,70],[170,70],[175,70],[180,70],[185,70],[190,70],[195,70],[200,70],[205,70],[210,70],[215,70],[220,70],[225,70],[230,70],[235,70],[240,70],[245,70],[250,70],[255,70],[260,70],[265,70],[270,70],[275,70],[280,70],[285,70],[290,70],[295,70],[300,70],[0,75],[5,75],[10,75],[15,75],[20,75],[25,75],[30,75],[35,75],[40,75],[45,75],[50,75],[55,75],[60,75],[65,75],[70,75],[75,75],[80,75],[85,75],[90,75],[95,75],[100,75],[105,75],[110,75],[115,75],[120,75],[125,75],[130,75],[135,75],[140,75],[145,75],[150,75],[155,75],[160,75],[165,75],[170,75],[175,75],[180,75],[185,75],[190,75],[195,75],[200,75],[205,75],[210,75],[215,75],[220,75],[225,75],[230,75],[235,75],[240,75],[245,75],[250,75],[255,75],[260,75],[265,75],[270,75],[275,75],[280,75],[285,75],[290,75],[295,75],[300,75],[0,80],[5,80],[10,80],[15,80],[20,80],[25,80],[30,80],[35,80],[40,80],[45,80],[50,80],[55,80],[60,80],[65,80],[70,80],[75,80],[80,80],[85,80],[90,80],[95,80],[100,80],[105,80],[110,80],[115,80],[120,80],[125,80],[130,80],[135,80],[140,80],[145,80],[150,80],[155,80],[160,80],[165,80],[170,80],[175,80],[180,80],[185,80],[190,80],[195,80],[200,80],[205,80],[210,80],[215,80],[220,80],[225,80],[230,80],[235,80],[240,80],[245,80],[250,80],[255,80],[260,80],[265,80],[270,80],[275,80],[280,80],[285,80],[290,80],[295,80],[300,80],[0,85],[5,85],[10,85],[15,85],[20,85],[25,85],[30,85],[35,85],[40,85],[45,85],[50,85],[55,85],[60,85],[65,85],[70,85],[75,85],[80,85],[85,85],[90,85],[95,85],[100,85],[105,85],[110,85],[115,85],[120,85],[125,85],[130,85],[135,85],[140,85],[145,85],[150,85],[155,85],[160,85],[165,85],[170,85],[175,85],[180,85],[185,85],[190,85],[195,85],[200,85],[205,85],[210,85],[215,85],[220,85],[225,85],[230,85],[235,85],[240,85],[245,85],[250,85],[255,85],[260,85],[265,85],[270,85],[275,85],[280,85],[285,85],[290,85],[295,85],[300,85],[0,90],[5,90],[10,90],[15,90],[20,90],[25,90],[30,90],[35,90],[40,90],[45,90],[50,90],[55,90],[60,90],[65,90],[70,90],[75,90],[80,90],[85,90],[90,90],[95,90],[100,90],[105,90],[110,90],[115,90],[120,90],[125,90],[130,90],[135,90],[140,90],[145,90],[150,90],[155,90],[160,90],[165,90],[170,90],[175,90],[180,90],[185,90],[190,90],[195,90],[200,90],[205,90],[210,90],[215,90],[220,90],[225,90],[230,90],[235,90],[240,90],[245,90],[250,90],[255,90],[260,90],[265,90],[270,90],[275,90],[280,90],[285,90],[290,90],[295,90],[300,90],[0,95],[5,95],[10,95],[15,95],[20,95],[25,95],[30,95],[35,95],[40,95],[45,95],[50,95],[55,95],[60,95],[65,95],[70,95],[75,95],[80,95],[85,95],[90,95],[95,95],[100,95],[105,95],[110,95],[115,95],[120,95],[125,95],[130,95],[135,95],[140,95],[145,95],[150,95],[155,95],[160,95],[165,95],[170,95],[175,95],[180,95],[185,95],[190,95],[195,95],[200,95],[205,95],[210,95],[215,95],[220,95],[225,95],[230,95],[235,95],[240,95],[245,95],[250,95],[255,95],[260,95],[265,95],[270,95],[275,95],[280,95],[285,95],[290,95],[295,95],[300,95],[0,100],[5,100],[10,100],[15,100],[20,100],[25,100],[30,100],[35,100],[40,100],[45,100],[50,100],[55,100],[60,100],[65,100],[70,100],[75,100],[80,100],[85,100],[90,100],[95,100],[100,100],[105,100],[110,100],[115,100],[120,100],[125,100],[130,100],[135,100],[140,100],[145,100],[150,100],[155,100],[160,100],[165,100],[170,100],[175,100],[180,100],[185,100],[190,100],[195,100],[200,100],[205,100],[210,100],[215,100],[220,100],[225,100],[230,100],[235,100],[240,100],[245,100],[250,100],[255,100],[260,100],[265,100],[270,100],[275,100],[280,100],[285,100],[290,100],[295,100],[300,100],[0,105],[5,105],[10,105],[15,105],[20,105],[25,105],[30,105],[35,105],[40,105],[45,105],[50,105],[55,105],[60,105],[65,105],[70,105],[75,105],[80,105],[85,105],[90,105],[95,105],[100,105],[105,105],[110,105],[115,105],[120,105],[125,105],[130,105],[135,105],[140,105],[145,105],[150,105],[155,105],[160,105],[165,105],[170,105],[175,105],[180,105],[185,105],[190,105],[195,105],[200,105],[205,105],[210,105],[215,105],[220,105],[225,105],[230,105],[235,105],[240,105],[245,105],[250,105],[255,105],[260,105],[265,105],[270,105],[275,105],[280,105],[285,105],[290,105],[295,105],[300,105],[0,110],[5,110],[10,110],[15,110],[20,110],[25,110],[30,110],[35,110],[40,110],[45,110],[50,110],[55,110],[60,110],[65,110],[70,110],[75,110],[80,110],[85,110],[90,110],[95,110],[100,110],[105,110],[110,110],[115,110],[120,110],[125,110],[130,110],[135,110],[140,110],[145,110],[150,110],[155,110],[160,110],[165,110],[170,110],[175,110],[180,110],[185,110],[190,110],[195,110],[200,110],[205,110],[210,110],[215,110],[220,110],[225,110],[230,110],[235,110],[240,110],[245,110],[250,110],[255,110],[260,110],[265,110],[270,110],[275,110],[280,110],[285,110],[290,110],[295,110],[300,110],[0,115],[5,115],[10,115],[15,115],[20,115],[25,115],[30,115],[35,115],[40,115],[45,115],[50,115],[55,115],[60,115],[65,115],[70,115],[75,115],[80,115],[85,115],[90,115],[95,115],[100,115],[105,115],[110,115],[115,115],[120,115],[125,115],[130,115],[135,115],[140,115],[145,115],[150,115],[155,115],[160,115],[165,115],[170,115],[175,115],[180,115],[185,115],[190,115],[195,115],[200,115],[205,115],[210,115],[215,115],[220,115],[225,115],[230,115],[235,115],[240,115],[245,115],[250,115],[255,115],[260,115],[265,115],[270,115],[275,115],[280,115],[285,115],[290,115],[295,115],[300,115],[0,120],[5,120],[10,120],[15,120],[20,120],[25,120],[30,120],[35,120],[40,120],[45,120],[50,120],[55,120],[60,120],[65,120],[70,120],[75,120],[80,120],[85,120],[90,120],[95,120],[100,120],[105,120],[110,120],[115,120],[120,120],[125,120],[130,120],[135,120],[140,120],[145,120],[150,120],[155,120],[160,120],[165,120],[170,120],[175,120],[180,120],[185,120],[190,120],[195,120],[200,120],[205,120],[210,120],[215,120],[220,120],[225,120],[230,120],[235,120],[240,120],[245,120],[250,120],[255,120],[260,120],[265,120],[270,120],[275,120],[280,120],[285,120],[290,120],[295,120],[300,120],[0,125],[5,125],[10,125],[15,125],[20,125],[25,125],[30,125],[35,125],[40,125],[45,125],[50,125],[55,125],[60,125],[65,125],[70,125],[75,125],[80,125],[85,125],[90,125],[95,125],[100,125],[105,125],[110,125],[115,125],[120,125],[125,125],[130,125],[135,125],[140,125],[145,125],[150,125],[155,125],[160,125],[165,125],[170,125],[175,125],[180,125],[185,125],[190,125],[195,125],[200,125],[205,125],[210,125],[215,125],[220,125],[225,125],[230,125],[235,125],[240,125],[245,125],[250,125],[255,125],[260,125],[265,125],[270,125],[275,125],[280,125],[285,125],[290,125],[295,125],[300,125],[0,130],[5,130],[10,130],[15,130],[20,130],[25,130],[30,130],[35,130],[40,130],[45,130],[50,130],[55,130],[60,130],[65,130],[70,130],[75,130],[80,130],[85,130],[90,130],[95,130],[100,130],[105,130],[110,130],[115,130],[120,130],[125,130],[130,130],[135,130],[140,130],[145,130],[150,130],[155,130],[160,130],[165,130],[170,130],[175,130],[180,130],[185,130],[190,130],[195,130],[200,130],[205,130],[210,130],[215,130],[220,130],[225,130],[230,130],[235,130],[240,130],[245,130],[250,130],[255,130],[260,130],[265,130],[270,130],[275,130],[280,130],[285,130],[290,130],[295,130],[300,130],[0,135],[5,135],[10,135],[15,135],[20,135],[25,135],[30,135],[35,135],[40,135],[45,135],[50,135],[55,135],[60,135],[65,135],[70,135],[75,135],[80,135],[85,135],[90,135],[95,135],[100,135],[105,135],[110,135],[115,135],[120,135],[125,135],[130,135],[135,135],[140,135],[145,135],[150,135],[155,135],[160,135],[165,135],[170,135],[175,135],[180,135],[185,135],[190,135],[195,135],[200,135],[205,135],[210,135],[215,135],[220,135],[225,135],[230,135],[235,135],[240,135],[245,135],[250,135],[255,135],[260,135],[265,135],[270,135],[275,135],[280,135],[285,135],[290,135],[295,135],[300,135],[0,140],[5,140],[10,140],[15,140],[20,140],[25,140],[30,140],[35,140],[40,140],[45,140],[50,140],[55,140],[60,140],[65,140],[70,140],[75,140],[80,140],[85,140],[90,140],[95,140],[100,140],[105,140],[110,140],[115,140],[120,140],[125,140],[130,140],[135,140],[140,140],[145,140],[150,140],[155,140],[160,140],[165,140],[170,140],[175,140],[180,140],[185,140],[190,140],[195,140],[200,140],[205,140],[210,140],[215,140],[220,140],[225,140],[230,140],[235,140],[240,140],[245,140],[250,140],[255,140],[260,140],[265,140],[270,140],[275,140],[280,140],[285,140],[290,140],[295,140],[300,140],[0,145],[5,145],[10,145],[15,145],[20,145],[25,145],[30,145],[35,145],[40,145],[45,145],[50,145],[55,145],[60,145],[65,145],[70,145],[75,145],[80,145],[85,145],[90,145],[95,145],[100,145],[105,145],[110,145],[115,145],[120,145],[125,145],[130,145],[135,145],[140,145],[145,145],[150,145],[155,145],[160,145],[165,145],[170,145],[175,145],[180,145],[185,145],[190,145],[195,145],[200,145],[205,145],[210,145],[215,145],[220,145],[225,145],[230,145],[235,145],[240,145],[245,145],[250,145],[255,145],[260,145],[265,145],[270,145],[275,145],[280,145],[285,145],[290,145],[295,145],[300,145],[0,150],[5,150],[10,150],[15,150],[20,150],[25,150],[30,150],[35,150],[40,150],[45,150],[50,150],[55,150],[60,150],[65,150],[70,150],[75,150],[80,150],[85,150],[90,150],[95,150],[100,150],[105,150],[110,150],[115,150],[120,150],[125,150],[130,150],[135,150],[140,150],[145,150],[150,150],[155,150],[160,150],[165,150],[170,150],[175,150],[180,150],[185,150],[190,150],[195,150],[200,150],[205,150],[210,150],[215,150],[220,150],[225,150],[230,150],[235,150],[240,150],[245,150],[250,150],[255,150],[260,150],[265,150],[270,150],[275,150],[280,150],[285,150],[290,150],[295,150],[300,150],[0,155],[5,155],[10,155],[15,155],[20,155],[25,155],[30,155],[35,155],[40,155],[45,155],[50,155],[55,155],[60,155],[65,155],[70,155],[75,155],[80,155],[85,155],[90,155],[95,155],[100,155],[105,155],[110,155],[115,155],[120,155],[125,155],[130,155],[135,155],[140,155],[145,155],[150,155],[155,155],[160,155],[165,155],[170,155],[175,155],[180,155],[185,155],[190,155],[195,155],[200,155],[205,155],[210,155],[215,155],[220,155],[225,155],[230,155],[235,155],[240,155],[245,155],[250,155],[255,155],[260,155],[265,155],[270,155],[275,155],[280,155],[285,155],[290,155],[295,155],[300,155],[0,160],[5,160],[10,160],[15,160],[20,160],[25,160],[30,160],[35,160],[40,160],[45,160],[50,160],[55,160],[60,160],[65,160],[70,160],[75,160],[80,160],[85,160],[90,160],[95,160],[100,160],[105,160],[110,160],[115,160],[120,160],[125,160],[130,160],[135,160],[140,160],[145,160],[150,160],[155,160],[160,160],[165,160],[170,160],[175,160],[180,160],[185,160],[190,160],[195,160],[200,160],[205,160],[210,160],[215,160],[220,160],[225,160],[230,160],[235,160],[240,160],[245,160],[250,160],[255,160],[260,160],[265,160],[270,160],[275,160],[280,160],[285,160],[290,160],[295,160],[300,160],[0,165],[5,165],[10,165],[15,165],[20,165],[25,165],[30,165],[35,165],[40,165],[45,165],[50,165],[55,165],[60,165],[65,165],[70,165],[75,165],[80,165],[85,165],[90,165],[95,165],[100,165],[105,165],[110,165],[115,165],[120,165],[125,165],[130,165],[135,165],[140,165],[145,165],[150,165],[155,165],[160,165],[165,165],[170,165],[175,165],[180,165],[185,165],[190,165],[195,165],[200,165],[205,165],[210,165],[215,165],[220,165],[225,165],[230,165],[235,165],[240,165],[245,165],[250,165],[255,165],[260,165],[265,165],[270,165],[275,165],[280,165],[285,165],[290,165],[295,165],[300,165]]

const BookCanvas = () => {
  const canvasRef = useRef<HTMLCanvasElement>(null);

  useEffect(() => {
    const canvas = canvasRef.current;
    if (!canvas) return;
    const ctx = canvas.getContext('2d');
    if (!ctx) return;

    let animationFrameId: number;

    const PARTICLE_COLOR = 'rgba(212, 154, 62, 0.85)';
    const PARTICLE_SIZE = 1.2;
    const MOUSE_RADIUS = 80;
    const REPEL_FORCE = 4;

    const dpr = window.devicePixelRatio || 1;
    const rect = canvas.getBoundingClientRect();
    canvas.width = rect.width * dpr;
    canvas.height = rect.height * dpr;
    ctx.scale(dpr, dpr);

    const canvasWidth = canvas.width / dpr;
    const canvasHeight = canvas.height / dpr;

    let particles: Particle[] = [];
    const mouse = { x: -1000, y: -1000 };

    class Particle {
      x: number;
      y: number;
      size: number;
      baseX: number;
      baseY: number;
      density: number;

      constructor(x: number, y: number) {
        this.x = x;
        this.y = y;
        this.size = Math.random() * PARTICLE_SIZE + 0.5;
        this.baseX = this.x;
        this.baseY = this.y;
        this.density = (Math.random() * 30) + 5;
      }

      draw() {
        ctx.fillStyle = PARTICLE_COLOR;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctx.closePath();
        ctx.fill();
      }

      update() {
        const dx = mouse.x - this.x;
        const dy = mouse.y - this.y;
        const distance = Math.sqrt(dx * dx + dy * dy);

        if (distance < MOUSE_RADIUS) {
          const forceDirectionX = dx / distance;
          const forceDirectionY = dy / distance;
          const force = (MOUSE_RADIUS - distance) / MOUSE_RADIUS;
          const directionX = forceDirectionX * force * this.density * REPEL_FORCE;
          const directionY = forceDirectionY * force * this.density * REPEL_FORCE;
          this.x -= directionX;
          this.y -= directionY;
        } else {
          if (this.x !== this.baseX) {
            const returnDx = this.x - this.baseX;
            this.x -= returnDx / 10;
          }
          if (this.y !== this.baseY) {
            const returnDy = this.y - this.baseY;
            this.y -= returnDy / 10;
          }
        }
      }
    }

    function init() {
      particles = [];
      if (points.length === 0) return;

      // 1. 确定数据源的边界
      const dataWidth = Math.max(...points.map(p => p[0])) + 10; // 加10是为了防止点在最边缘
      const dataHeight = Math.max(...points.map(p => p[1])) + 10;

      // 2. 计算缩放比例，以适应Canvas，并保持纵横比
      const scaleX = canvasWidth / dataWidth;
      const scaleY = canvasHeight / dataHeight;
      const scale = Math.min(scaleX, scaleY) * 0.85; // 乘以0.85留出一些边距

      // 3. 计算偏移量，使图形居中
      const scaledDataWidth = dataWidth * scale;
      const scaledDataHeight = dataHeight * scale;
      const offsetX = (canvasWidth - scaledDataWidth) / 2;
      const offsetY = (canvasHeight - scaledDataHeight) / 2;

      // 4. 根据硬编码的坐标数据创建粒子
      points.forEach(point => {
        const x = point[0] * scale + offsetX;
        const y = point[1] * scale + offsetY;
        particles.push(new Particle(x, y));
      });
    }

    function animate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      particles.forEach(p => {
        p.update();
        p.draw();
      });
      animationFrameId = requestAnimationFrame(animate);
    }

    const handleMouseMove = (event: MouseEvent) => {
      const rect = canvas.getBoundingClientRect();
      mouse.x = (event.clientX - rect.left);
      mouse.y = (event.clientY - rect.top);
    };

    const handleMouseOut = () => {
      mouse.x = -1000;
      mouse.y = -1000;
    };

    window.addEventListener('mousemove', handleMouseMove);
    window.addEventListener('mouseout', handleMouseOut);

    init();
    animate();

    return () => {
      cancelAnimationFrame(animationFrameId);
      window.removeEventListener('mousemove', handleMouseMove);
      window.removeEventListener('mouseout', handleMouseOut);
    };
  }, []);

  return (
      <div className="w-full h-96 flex justify-center items-center" style={{ background: '#000000' }}>
        <canvas ref={canvasRef} style={{ width: '100%', height: '100%' }} />
      </div>
  );
};

export default BookCanvas;